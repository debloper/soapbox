#!/usr/bin/env node

// Core modules
const fs = require('fs')
const path = require('path')

// 3rd party modules
const dot = require('dot')

// Locate all the directory paths needed for this
// @TODO: get rid of hardcoded names
const themeDir = (process.cwd() + "/theme")
const distDir  = (process.cwd() + "/dist")
const dataDir  = (distDir + "/data")

// First, let's generate the `index.html` from homepage template
// @TODO: decouple template rendering, to allow alternatives
let indexTmpl = dot.template(fs.readFileSync((themeDir + '/home.html'), 'utf8'))
let indexData = JSON.parse(fs.readFileSync((dataDir + '/index.json'), 'utf8'))
let indexPage = indexTmpl(indexData)

fs.writeFile((distDir + "/index.html"), indexPage, { mode: 0o664 }, function (e) {
  if (e) throw e
  console.log('Generated index file.')
})
